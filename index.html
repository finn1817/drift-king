<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRIFT KING - Minimal Drifting Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden;
        }

        #gameContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }

        canvas {
            border: 3px solid #fff;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        /* HUD Overlay */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            z-index: 100;
        }

        #hud div {
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
            min-width: 200px;
        }

        .label {
            color: #ffd700;
            font-weight: bold;
        }

        /* Controls Info */
        #controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
        }

        #controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }

        #controls p {
            margin: 5px 0;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div id="gameContainer"></div>
    
    <!-- HUD -->
    <div id="hud">
        <div><span class="label">Speed:</span> <span id="speedDisplay">0</span> MPH</div>
        <div><span class="label">Car:</span> <span id="carType">Drift King</span></div>
        <div><span class="label">Track:</span> <span id="trackName">The Lot</span></div>
        <div><span class="label">Weather:</span> <span id="weather">Clear</span></div>
    </div>

    <!-- Controls Guide -->
    <div id="controls">
        <h3>ðŸŽ® CONTROLS</h3>
        <p><strong>WASD / Arrows:</strong> Drive</p>
        <p><strong>R:</strong> Reset Car</p>
        <p><strong>T:</strong> Toggle Rain</p>
        <p><strong>ESC:</strong> Menu</p>
    </div>

    <!-- Phaser 3 -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

    <!-- Game Code -->
    <script>
        // ========================================
        // CAR DATA (kept simple for now)
        // ========================================
        const CAR_TYPES = {
            drift: {
                name: "Drift King",
                topSpeed: 350,      // pixels/sec
                acceleration: 500,   // pixels/sec^2
                handling: 180,       // deg/sec
                color: 0xff4444
            }
            // Placeholder for future cars:
            // speed: { name: "Speedster", topSpeed: 420, acceleration: 600, handling: 140, color: 0x4444ff },
            // fun:   { name: "All-Rounder", topSpeed: 380, acceleration: 520, handling: 160, color: 0x44ff44 }
        };

        // ========================================
        // MENU SCENE
        // ========================================
        
        class MenuScene extends Phaser.Scene {
            constructor() {
                super({ key: 'MenuScene' });
            }

            create() {
                // Title
                this.add.text(640, 150, 'DRIFT KING', {
                    fontSize: '72px',
                    fontFamily: 'Arial Black',
                    fill: '#ffd700',
                    stroke: '#000',
                    strokeThickness: 8
                }).setOrigin(0.5);

                this.add.text(640, 220, 'Semi-Realistic Drifting Experience', {
                    fontSize: '24px',
                    fill: '#fff'
                }).setOrigin(0.5);

                // Track Selection (only one for now)
                this.add.text(640, 300, 'SELECT TRACK:', {
                    fontSize: '32px',
                    fill: '#ffd700'
                }).setOrigin(0.5);

                const lotBtn = this.add.text(640, 380, 'The Lot (Parking Lot)', {
                    fontSize: '24px',
                    fill: '#fff',
                    backgroundColor: '#44aa44',
                    padding: { x: 20, y: 10 }
                }).setOrigin(0.5).setInteractive();

                lotBtn.on('pointerdown', () => {
                    this.scene.start('GameScene', { track: 'lot', car: 'drift' });
                });
                lotBtn.on('pointerover', () => lotBtn.setStyle({ fill: '#ffd700' }));
                lotBtn.on('pointerout', () => lotBtn.setStyle({ fill: '#fff' }));

                // Placeholders for future tracks (to be re-added later):
                // this.add.text(640, 430, 'The Circle (Short Track) - Coming Soon', { fontSize: '18px', fill: '#999' }).setOrigin(0.5);
                // this.add.text(640, 470, 'Daytona 500 (NASCAR Oval) - Coming Soon', { fontSize: '18px', fill: '#999' }).setOrigin(0.5);
                // this.add.text(640, 510, 'Touge Pass (Drift Track) - Coming Soon', { fontSize: '18px', fill: '#999' }).setOrigin(0.5);

                // Instructions
                this.add.text(640, 600, 'Click a track to start!', {
                    fontSize: '18px',
                    fill: '#aaa'
                }).setOrigin(0.5);
            }
        }

        // ========================================
        // MAIN GAME SCENE
        // ========================================
        
        class GameScene extends Phaser.Scene {
            constructor() {
                super({ key: 'GameScene' });
            }

            init(data) {
                this.selectedTrack = data.track || 'lot';
                this.selectedCar = data.car || 'drift';
                this.isRaining = false;
                this.playerSpeed = 0; // pixels/sec
            }

            create() {
                // Car stats
                this.carData = CAR_TYPES[this.selectedCar];
                document.getElementById('carType').textContent = this.carData.name;
                document.getElementById('trackName').textContent = this.getTrackName(this.selectedTrack);

                // Create the world
                this.createWorld();
                this.createPlayer();
                this.setupCamera();
                this.setupControls();

                // Update HUD
                this.updateHUD();
            }

            getTrackName(key) {
                const names = {
                    lot: 'The Lot (Parking Lot)',
                    circle: 'The Circle',
                    daytona: 'Daytona 500',
                    touge: 'Touge Pass'
                };
                return names[key] || 'Unknown';
            }

            createWorld() {
                // Create a large parking lot (3000x3000)
                this.worldWidth = 3000;
                this.worldHeight = 3000;

                // Visual ground
                this.add.rectangle(
                    this.worldWidth / 2,
                    this.worldHeight / 2,
                    this.worldWidth,
                    this.worldHeight,
                    0x444444
                ).setDepth(-10);

                // Parking lines (visual only)
                const graphics = this.add.graphics();
                graphics.lineStyle(2, 0xffff00, 0.35);

                for (let x = 200; x < this.worldWidth; x += 150) {
                    graphics.lineBetween(x, 100, x, this.worldHeight - 100);
                }
                for (let y = 200; y < this.worldHeight; y += 100) {
                    graphics.lineBetween(100, y, this.worldWidth - 100, y);
                }

                // Arcade physics world bounds
                this.physics.world.setBounds(0, 0, this.worldWidth, this.worldHeight, true, true, true, true);
            }

            createPlayer() {
                // Create a simple car texture via Graphics
                // IMPORTANT: Phaser angle 0 faces to the RIGHT, so make car's "front" point right.
                const g = this.add.graphics();
                g.fillStyle(this.carData.color, 1);
                g.fillRect(0, 0, 100, 60); // body (wide)
                g.fillStyle(0xffffff, 1);
                g.fillRect(85, 24, 10, 12); // small front indicator at the right
                g.generateTexture('carTexture', 100, 60);
                g.destroy();

                // Arcade physics sprite for the car
                this.player = this.physics.add.image(this.worldWidth / 2, this.worldHeight / 2, 'carTexture');
                this.player.setOrigin(0.5, 0.5);
                this.player.setCollideWorldBounds(true);
                this.player.setDamping(true);
                this.player.setDrag(0.02); // linear damping factor (with useDamping)
                this.player.setMaxVelocity(this.carData.topSpeed);
                this.player.rotation = -Math.PI / 2; // face up initially (but forward now matches rotation)

                // Simple speed tracker for HUD (pixels/sec)
                this.player.carSpeed = 0;
            }

            setupCamera() {
                this.cameras.main.startFollow(this.player, true, 0.1, 0.1);
                this.cameras.main.setZoom(0.8);
                this.cameras.main.setBounds(0, 0, this.worldWidth, this.worldHeight);
            }

            setupControls() {
                // Keyboard
                this.keys = this.input.keyboard.addKeys({
                    up: Phaser.Input.Keyboard.KeyCodes.W,
                    down: Phaser.Input.Keyboard.KeyCodes.S,
                    left: Phaser.Input.Keyboard.KeyCodes.A,
                    right: Phaser.Input.Keyboard.KeyCodes.D,
                    reset: Phaser.Input.Keyboard.KeyCodes.R,
                    weather: Phaser.Input.Keyboard.KeyCodes.T,
                    menu: Phaser.Input.Keyboard.KeyCodes.ESC
                });

                // Also allow arrow keys
                this.cursors = this.input.keyboard.createCursorKeys();
            }

            update(time, delta) {
                if (!this.player) return;

                // Handle input and movement
                this.updateCar(delta);

                // Update HUD
                this.updateHUD();

                // Special keys
                if (Phaser.Input.Keyboard.JustDown(this.keys.weather)) {
                    this.toggleWeather();
                }
                if (Phaser.Input.Keyboard.JustDown(this.keys.reset)) {
                    this.resetCar();
                }
                if (Phaser.Input.Keyboard.JustDown(this.keys.menu)) {
                    this.scene.start('MenuScene');
                }
            }
            updateCar(delta) {
                const dt = delta / 1000;

                // Read inputs (WASD or arrows)
                const up = this.keys.up.isDown || this.cursors.up.isDown;
                const down = this.keys.down.isDown || this.cursors.down.isDown;
                const left = this.keys.left.isDown || this.cursors.left.isDown;
                const right = this.keys.right.isDown || this.cursors.right.isDown;

                // Rotate
                const turnRate = Phaser.Math.DEG_TO_RAD * this.carData.handling * dt;
                if (left) this.player.rotation -= turnRate;
                if (right) this.player.rotation += turnRate;

                // Throttle/Brake
                const accel = this.carData.acceleration;
                if (up) this.playerSpeed += accel * dt;
                if (down) this.playerSpeed -= accel * dt;

                // Clamp speeds
                const maxFwd = this.carData.topSpeed;
                const maxRev = this.carData.topSpeed * 0.5;
                this.playerSpeed = Phaser.Math.Clamp(this.playerSpeed, -maxRev, maxFwd);

                // Natural drag
                const drag = 0.98;
                this.playerSpeed *= drag;

                // Apply velocity based on rotation
                const vx = Math.cos(this.player.rotation) * this.playerSpeed;
                const vy = Math.sin(this.player.rotation) * this.playerSpeed;
                this.player.setVelocity(vx, vy);

                // Update HUD speed (rough MPH approximation)
                this.player.carSpeed = Math.max(0, Math.round(Math.abs(this.playerSpeed) * 0.06));
            }

            updateHUD() {
                document.getElementById('speedDisplay').textContent = this.player.carSpeed || 0;
            }

            toggleWeather() {
                this.isRaining = !this.isRaining;
                document.getElementById('weather').textContent = this.isRaining ? 'Rain ðŸŒ§ï¸' : 'Clear â˜€ï¸';
                this.cameras.main.setBackgroundColor(this.isRaining ? 0x444455 : 0x2d2d2d);
            }

            resetCar() {
                this.playerSpeed = 0;
                this.player.setPosition(this.worldWidth / 2, this.worldHeight / 2);
                this.player.setVelocity(0, 0);
                this.player.rotation = -Math.PI / 2;
            }
        }

        // ========================================
        // GAME CONFIGURATION
        // ========================================
        
        const config = {
            type: Phaser.AUTO,
            width: 1280,
            height: 720,
            parent: 'gameContainer',
            backgroundColor: '#2d2d2d',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: [MenuScene, GameScene]
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
